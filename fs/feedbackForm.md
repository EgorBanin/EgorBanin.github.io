Сайт, на котором задают вопросы https://ru.stackoverflow.com/
У них есть правила о том как задавать вопросы, для того чтобы помощь была полезной -- https://ru.stackoverflow.com/help/on-topic

# Форма обратной связи

## 1. HTML-форма

Понадобится разобраться с тегами `<form>` `<input>`, `<textarea>` и `<button>`. Например можно почитать про формы в [учебнике](http://htmlbook.ru/samhtml5/formy) на htmlbook.ru.


Начнём с самой простой формы. Создадим php-файл form.php следующего содержания

```php
<form action="" method="post">
	<div>
		<textarea name="message"></textarea>
	</div>
	<div>
		<button type="submit">Отправить</button>
	</div>
</form>
```

Тут пока нет никакого php и это нормально. Пока можно посмотреть на результат -- если перейти на form.php, то форма отображается. Если попробовать отправить форму, то страница просто перезагрузится.

## 2. Добавляем PHP

Уже сейчас форма отправляется на сервер в тот же form.php -- если указывать пустой action (`action=""`), то форма отправляется на текущий url. Так как form.php просто отображает форму, то в результате мы снова получаем такую же страницу. Чтобы обработать форму добавим в form.php следующее:

```php
<?php

$message = $_POST['message']?? null; // получаем сообщение из суперглобального массива $_POST (https://www.php.net/manual/ru/reserved.variables.post.php)

if ($message !== null) { // если нам прислали сообщение
	echo "Сообщение: $message"; // выводим сообщение
	exit(0); // и на этом завершаем работу
}

// если сообщение не присылали, то окажемся тут и отобразим форму

?>
<form action="" method="post">
	<div>
		<textarea name="message"></textarea>
	</div>
	<div>
		<button type="submit">Отправить</button>
	</div>
</form>
```

Можно попробовать как это работает.

## Отправляем сообщение на почту

Работа электронной почты довольно обширная тема, здесь всё максимально упростим. В PHP есть функция [mail](https://www.php.net/manual/ru/function.mail.php), используем её.

```php
<?php

$message = $_POST['message']?? null; // получаем сообщение из суперглобального массива $_POST (https://www.php.net/manual/ru/reserved.variables.post.php)

if ($message !== null) { // если нам прислали сообщение
	mail(
		'mymail@example.com', // на какой ящик отправлять почту
		'Сообщение с сайта', // тема письма
		wordwrap($message, 70, "\r\n") // собственно само сообщение (к сообщению есть особые требования, читайте документацию https://php.net/mail)
	);
	echo "Ваше сообщение отправлено. Спасибо."; // выводим уведомление
	exit(0); // и на этом завершаем работу
}

// если сообщение не присылали, то окажемся тут и отобразим форму

?>
<form action="" method="post">
	<div>
		<textarea name="message"></textarea>
	</div>
	<div>
		<button type="submit">Отправить</button>
	</div>
</form>

```

Работа функции mail зависит от настроек сервера. Она может работать по-разному на openserver (читайте документацию https://ospanel.io/docs/#smtp) и на хостинге (можно узнать у хостера спросив: "как настроить отправку почты по php mail?").

Сейчас форма уже работает. Если openserver настроен, то можно попробовать отправить себе письмо.


## Доработки

### Отправка пустого сообщения

Сейчас можно отправить пустое сообщение. Надо добавить проверку и не отправлять письмо, если посетитель сайта ничего не написал.

Делается это просто: убираем пробелы в начале и в конце сообщения, и если после этого в сообщении ничего не осталось, то ничего не отправляем, а сообщаем посетителю, что поле сообщение обязательное.

```php
<?php

$errors = []; // создадим список ошибок, если пользователь неправильно заполнит форму, то будем добавлять сообщения в этот список
$message = $_POST['message']?? null; // получаем сообщение из суперглобального массива $_POST (https://www.php.net/manual/ru/reserved.variables.post.php)

if ($message !== null) { // если нам прислали сообщение
	$message = trim($message);
	if (empty($message)) {
		$errors[] = 'Обязательно что-нибудь напишите.'; // если сообщение пустое, то добавим ошибку
	}

	if (empty($errors)) { // отправляем только если нет ошибок
		mail(
			'mymail@example.com', // на какой ящик отправлять почту
			'Сообщение с сайта', // тема письма
			wordwrap($message, 70, "\r\n") // собственно само сообщение (к сообщению есть особые требования, читайте документацию https://php.net/mail)
		);
		echo "Ваше сообщение отправлено. Спасибо."; // выводим уведомление
		exit(0); // и на этом завершаем работу
	}
}

// если сообщение не присылали, то окажемся тут и отобразим форму

?>
<?php if ($errors): ?>
	<div style="color:red">
		<?php foreach ($errors as $error): ?>
			<div><?= htmlspecialchars($error) ?></div>
		<?php endforeach ?>
	</div>
<?php endif ?>
<form action="" method="post">
	<div>
		<textarea name="message"></textarea>
	</div>
	<div>
		<button type="submit">Отправить</button>
	</div>
</form>

```

Тут я добавил в html-часть немного php-кода. Я использовал [альтернативный синтаксис](https://www.php.net/manual/ru/control-structures.alternative-syntax.php), такой синтаксис используется для вставок php-кода в HTML.

Я использовал функцию [htmlspecialchars](https://php.net/htmlspecialchars), чтобы исключить неправильную подстановку текста ошибки. Если ошибка вдруг будет содержать какие-то символы являющиеся специальными в HTML (например угловые скобки или двойные кавычки), то функция заменит их на специальные последовательности.

### Повторная отправка сообщения

Сейчас у формы есть недостаток -- если нажать f5 после отправки, то форма будет отправлена повторно. Чтобы этого избежать, можно сделать редирект (перенаправление). Редирект это ответ сервера, в котором он просит клиента (браузер) выполнить другой запрос. Обычно редиректы используются для перенаправления в случае неправильного запроса страницы (например если набрать https://php.net/redirect, то сайт перенаправит нас на другую страницу https://www.php.net/manual/ru/function.header.php).

По сути редирект это один заголовок ответа сервера:

```php
header("Location: /thanks.php");
```

Вместо вывода сообщения об отправке, перенаправим на страницу с таким сообщением:

```php
<?php

$errors = []; // создадим список ошибок, если пользователь неправильно заполнит форму, то будем добавлять сообщения в этот список
$message = $_POST['message']?? null; // получаем сообщение из суперглобального массива $_POST (https://www.php.net/manual/ru/reserved.variables.post.php)

if ($message !== null) { // если нам прислали сообщение
	$message = trim($message);
	if (empty($message)) {
		$errors[] = 'Обязательно что-нибудь напишите.'; // если сообщение пустое, то добавим ошибку
	}

	if (empty($errors)) { // отправляем только если нет ошибок
		mail(
			'mymail@example.com', // на какой ящик отправлять почту
			'Сообщение с сайта', // тема письма
			wordwrap($message, 70, "\r\n") // собственно само сообщение (к сообщению есть особые требования, читайте документацию https://php.net/mail)
		);
		header("Location: /thanks.php"); // перенаправляем на страницу с сообщением об успешной 
		exit(0); // и на этом завершаем работу
	}
}

// если сообщение не присылали, то окажемся тут и отобразим форму

?>
<?php if ($errors): ?>
	<div style="color:red">
		<?php foreach ($errors as $error): ?>
			<div><?= htmlspecialchars($error) ?></div>
		<?php endforeach ?>
	</div>
<?php endif ?>
<form action="" method="post">
	<div>
		<textarea name="message"></textarea>
	</div>
	<div>
		<button type="submit">Отправить</button>
	</div>
</form>

```

Страницу thanx.php тоже надо добавить. 

## Дальнейшие шаги

Обычно форма обратной связи содержит поле с информацией о том, как связаться с отправителем. Иногда там просят указать имейл или телефон. В современном мире человек может предпочитать связь через телеграм или вотсап, поэтому не следует жёстко ограничивать это поле. Можно добавить в форму поле Как вас зовут? и Как с вами связаться?.

Многим людям удобнее написать в месенджер, чем заполнять форму. Поэтому современные сайты обычно содержат кнопки со ссылками на телеграм, вотсап, инстаграм и другие способы связи. Можно добавить такие кнопки (лучше не использовать для них личные аккаунты, а завести отдельные для связи через сайт).

## Предостережения

Важно помнить, что формой могут воспользоваться для отправки мошеннических сообщений и спама. К сообщениям из формы обратной связи надо относится как, например, к письмам от неизвестных отправителей.

Не следует использовать для связи свой личный почтовый ящик и свои личные меседжеры (вотсап, телеграм и тд), так как большое количество спама может привести к необходимости в дальнейшем их удалить и завести новые.
